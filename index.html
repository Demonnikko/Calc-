<!-- /index.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Illusionist OS</title>

    <meta name="theme-color" content="#050507">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --gold-primary: #f59e0b;
            --dark-bg: #050507;
            --card-surface: rgba(255, 255, 255, 0.03);
            --card-border: rgba(255, 255, 255, 0.06);
            --text-main: #e2e8f0;
            --text-muted: #94a3b8;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-main);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            padding-top: env(safe-area-inset-top, 20px);
            padding-bottom: env(safe-area-inset-bottom, 20px);
        }

        h1, h2, h3, .font-display {
            font-family: 'Cinzel', serif;
        }

        /* Background Effects */
        .noise-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 0; opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }
        #bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }

        /* UI Components */
        .glass-panel {
            background: linear-gradient(180deg, rgba(30, 41, 59, 0.7) 0%, rgba(15, 23, 42, 0.6) 100%);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid var(--card-border);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5), inset 0 0 0 1px rgba(255, 255, 255, 0.05);
            border-radius: 16px;
        }

        .input-group {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 4px 16px;
            transition: border-color 0.2s;
        }
        .input-group:focus-within { border-color: rgba(245, 158, 11, 0.5); }

        .magic-input {
            background: transparent;
            border: none;
            color: white;
            width: 100%;
            padding: 10px 0;
            outline: none;
            font-size: 15px;
            text-align: right;
        }
        .magic-input::placeholder { color: rgba(255,255,255,0.2); }

        .magic-select {
            background: transparent;
            border: none;
            color: white;
            width: 100%;
            padding: 10px 0;
            outline: none;
            appearance: none;
            text-align: right;
            direction: rtl;
        }
        .magic-select option { background: #1e293b; color: white; text-align: left; }

        .label-text {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            color: var(--text-muted);
            flex-shrink: 0;
        }

        .btn-gold {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: #000;
            font-weight: 700;
            border: none;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
            transition: transform 0.1s, box-shadow 0.2s;
        }
        .btn-gold:active { transform: scale(0.98); }

        .btn-icon {
            width: 36px; height: 36px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 10px;
            background: rgba(255,255,255,0.05);
            color: var(--text-muted);
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-icon:hover { background: rgba(255,255,255,0.1); color: white; }

        /* Toggle Switch */
        .switch { position: relative; display: inline-block; width: 44px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(255,255,255,0.1); transition: .4s; border-radius: 34px;
        }
        .slider:before {
            position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px;
            background-color: white; transition: .4s; border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--gold-primary); }
        input:checked + .slider:before { transform: translateX(20px); background-color: #000; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }

        .animate-enter { animation: fade-in-up 0.4s ease-out forwards; }
        @keyframes fade-in-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Modal */
        .modal-backdrop {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(8px);
            z-index: 100; display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .modal-backdrop.active { opacity: 1; pointer-events: auto; }
        .modal-content {
            background: #0f172a; border: 1px solid rgba(245, 158, 11, 0.2);
            width: 100%; max-width: 420px; height: 100%; max-height: 100vh; overflow-y: auto;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            transform: translateY(20px); transition: transform 0.3s;

            padding-top: calc(env(safe-area-inset-top) + 24px);
            padding-bottom: env(safe-area-inset-bottom);
        }
        @media(min-width: 640px) {
            .modal-content {
                height: auto; max-height: 85vh; border-radius: 20px;
                padding-top: 0;
            }
        }
        .modal-backdrop.active .modal-content { transform: translateY(0); }

        /* Admin Settings Specifics */
        .admin-section { border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 12px; margin-bottom: 12px; }
        .admin-header { display: flex; justify-content: space-between; align-items: center; cursor: pointer; padding: 8px 0; }
        .admin-content { display: none; padding-top: 8px; }
        .admin-content.open { display: block; animation: fade-in-up 0.2s; }
        .edit-row { display: flex; gap: 8px; margin-bottom: 8px; align-items: center; }
        .edit-input { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: white; border-radius: 8px; padding: 6px 10px; width: 100%; outline: none; font-size: 13px; }
        .edit-input:focus { border-color: var(--gold-primary); }
        .btn-add-mini { width: 100%; padding: 8px; border: 1px dashed rgba(255,255,255,0.2); color: rgba(255,255,255,0.5); border-radius: 8px; font-size: 12px; transition: 0.2s; }
        .btn-add-mini:hover { border-color: var(--gold-primary); color: var(--gold-primary); }

        .btn-del-mini {
            color: #ef4444;
            padding: 8px;
            cursor: pointer;
            opacity: 0.7;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(239, 68, 68, 0.1);
            border-radius: 8px;
            border: none;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        .btn-del-mini:hover {
            opacity: 1;
            background: rgba(239, 68, 68, 0.2);
        }

        /* ========= SPLASH (NEW) ========= */
        .splash {
            position: fixed;
            inset: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            background:
                radial-gradient(1200px 900px at 50% 45%, rgba(245,158,11,0.10), transparent 55%),
                radial-gradient(900px 700px at 30% 70%, rgba(100,116,139,0.12), transparent 60%),
                radial-gradient(1200px 900px at 70% 20%, rgba(245,158,11,0.06), transparent 55%),
                linear-gradient(180deg, #050507 0%, #04060b 100%);
            overflow: hidden;
            opacity: 1;
            transition: opacity 520ms ease, transform 520ms ease;
            transform: translateZ(0);
        }
        .splash.hide {
            opacity: 0;
            pointer-events: none;
            transform: scale(1.02);
        }
        .splash::before {
            content: "";
            position: absolute;
            inset: -40%;
            background:
                radial-gradient(closest-side, rgba(245,158,11,0.16), transparent 70%),
                radial-gradient(closest-side, rgba(245,158,11,0.10), transparent 72%),
                radial-gradient(closest-side, rgba(255,255,255,0.05), transparent 68%);
            filter: blur(28px);
            opacity: 0.55;
            animation: splashGlowMove 4.8s ease-in-out infinite;
        }
        .splash::after {
            content: "";
            position: absolute;
            inset: 0;
            opacity: 0.08;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
            mix-blend-mode: overlay;
        }
        @keyframes splashGlowMove {
            0%   { transform: translate(-4%, -3%) rotate(0deg); }
            50%  { transform: translate(4%, 3%) rotate(8deg); }
            100% { transform: translate(-4%, -3%) rotate(0deg); }
        }

        .splash-stage {
            position: relative;
            width: min(92vw, 420px);
            height: min(92vh, 720px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 26px;
            padding: 28px 20px;
        }

        .splash-title {
            font-family: 'Cinzel', serif;
            font-weight: 800;
            letter-spacing: 0.08em;
            font-size: clamp(22px, 5.2vw, 34px);
            color: transparent;
            background-clip: text;
            -webkit-background-clip: text;
            background-image: linear-gradient(135deg, #fde68a 0%, #f59e0b 55%, #d97706 100%);
            text-shadow:
                0 0 20px rgba(245,158,11,0.25),
                0 0 40px rgba(245,158,11,0.12);
            animation: titlePulse 2.4s ease-in-out infinite;
            text-align: center;
        }
        @keyframes titlePulse {
            0%,100% { filter: brightness(1); transform: translateY(0); }
            50% { filter: brightness(1.15); transform: translateY(-1px); }
        }

        .splash-sub {
            margin-top: -16px;
            font-size: 11px;
            font-weight: 800;
            letter-spacing: 0.34em;
            text-transform: uppercase;
            color: rgba(148,163,184,0.85);
            text-align: center;
        }

        .splash-emblem {
            position: relative;
            width: 140px;
            height: 140px;
            display: grid;
            place-items: center;
            transform: translateZ(0);
        }

        .splash-orbit {
            position: absolute;
            inset: -18px;
            border-radius: 999px;
            background:
                conic-gradient(from 180deg,
                    rgba(245,158,11,0.00) 0deg,
                    rgba(245,158,11,0.25) 60deg,
                    rgba(245,158,11,0.00) 140deg,
                    rgba(245,158,11,0.18) 220deg,
                    rgba(245,158,11,0.00) 360deg
                );
            filter: blur(0.2px);
            animation: orbitSpin 2.8s linear infinite;
            opacity: 0.9;
            mask: radial-gradient(circle at center, transparent 58%, #000 62%);
            -webkit-mask: radial-gradient(circle at center, transparent 58%, #000 62%);
        }
        @keyframes orbitSpin { to { transform: rotate(360deg); } }

        .splash-sparks {
            position: absolute;
            inset: -40px;
            pointer-events: none;
            opacity: 0.9;
            filter: blur(0.2px);
            animation: sparksFloat 3.6s ease-in-out infinite;
        }
        @keyframes sparksFloat {
            0%,100% { transform: translateY(0px); opacity: 0.75; }
            50% { transform: translateY(-6px); opacity: 1; }
        }

        .splash-card {
            position: relative;
            width: 118px;
            height: 118px;
            border-radius: 26px;
            background:
                radial-gradient(120px 120px at 30% 20%, rgba(255,255,255,0.10), transparent 55%),
                linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
            border: 1px solid rgba(245,158,11,0.22);
            box-shadow:
                0 18px 50px rgba(0,0,0,0.65),
                0 0 0 1px rgba(255,255,255,0.05) inset,
                0 0 30px rgba(245,158,11,0.12);
            display: grid;
            place-items: center;
            animation: emblemBreathe 2.8s ease-in-out infinite;
        }
        @keyframes emblemBreathe {
            0%,100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-4px) scale(1.02); }
        }

        .splash-star {
            position: absolute;
            right: 14px;
            bottom: 14px;
            width: 34px;
            height: 34px;
            opacity: 0.55;
            filter: drop-shadow(0 0 14px rgba(245,158,11,0.18));
            animation: starTwinkle 2.2s ease-in-out infinite;
        }
        @keyframes starTwinkle {
            0%,100% { transform: rotate(0deg) scale(1); opacity: 0.40; }
            50% { transform: rotate(12deg) scale(1.08); opacity: 0.75; }
        }

        .splash-hint {
            margin-top: 8px;
            font-size: 12px;
            font-weight: 700;
            color: rgba(226,232,240,0.72);
            text-align: center;
        }
        .splash-hint small {
            display: block;
            margin-top: 6px;
            color: rgba(148,163,184,0.70);
            font-weight: 600;
        }

        .splash-progress {
            margin-top: 8px;
            width: min(72vw, 260px);
            height: 5px;
            border-radius: 999px;
            background: rgba(255,255,255,0.06);
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.06);
        }
        .splash-progress > div {
            height: 100%;
            width: 35%;
            border-radius: 999px;
            background: linear-gradient(90deg, rgba(245,158,11,0.20), rgba(245,158,11,0.95), rgba(245,158,11,0.20));
            animation: progressSweep 1.6s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(245,158,11,0.18));
        }
        @keyframes progressSweep {
            0% { transform: translateX(-110%); }
            100% { transform: translateX(310%); }
        }
        /* ========= /SPLASH ========= */
    </style>
</head>
<body class="flex flex-col items-center">

    <div class="noise-overlay"></div>
    <canvas id="bg-canvas"></canvas>

    <!-- SPLASH (NEW) -->
    <div id="splash" class="splash" aria-hidden="true">
        <div class="splash-stage">
            <div class="splash-title">Illusionist OS</div>
            <div class="splash-sub">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</div>

            <div class="splash-emblem">
                <div class="splash-orbit"></div>

                <!-- subtle sparks (svg) -->
                <svg class="splash-sparks" viewBox="0 0 240 240" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g opacity="0.85">
                        <circle cx="58" cy="72" r="1.6" fill="rgba(245,158,11,0.9)"/>
                        <circle cx="188" cy="84" r="1.2" fill="rgba(255,255,255,0.45)"/>
                        <circle cx="176" cy="162" r="1.4" fill="rgba(245,158,11,0.65)"/>
                        <circle cx="72" cy="168" r="1.1" fill="rgba(255,255,255,0.35)"/>
                        <circle cx="118" cy="44" r="1.0" fill="rgba(245,158,11,0.55)"/>
                        <circle cx="206" cy="128" r="1.0" fill="rgba(245,158,11,0.45)"/>
                        <circle cx="36" cy="128" r="1.0" fill="rgba(245,158,11,0.45)"/>
                    </g>
                </svg>

                <div class="splash-card">
                    <!-- Calendar+gear emblem (inline SVG, gold) -->
                    <svg width="86" height="86" viewBox="0 0 96 96" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="g" x1="16" y1="10" x2="80" y2="90" gradientUnits="userSpaceOnUse">
                                <stop stop-color="#FDE68A"/>
                                <stop offset="0.52" stop-color="#F59E0B"/>
                                <stop offset="1" stop-color="#D97706"/>
                            </linearGradient>
                            <filter id="gl" x="-40%" y="-40%" width="180%" height="180%">
                                <feGaussianBlur stdDeviation="2" result="b"/>
                                <feMerge>
                                    <feMergeNode in="b"/>
                                    <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                        </defs>

                        <!-- calendar -->
                        <g filter="url(#gl)">
                            <path d="M22 26c0-4.4 3.6-8 8-8h36c4.4 0 8 3.6 8 8v34c0 4.4-3.6 8-8 8H30c-4.4 0-8-3.6-8-8V26Z"
                                  fill="rgba(0,0,0,0.25)" stroke="url(#g)" stroke-width="3.2" />
                            <path d="M22 34h52" stroke="rgba(245,158,11,0.45)" stroke-width="2.4"/>
                            <path d="M34 14v10" stroke="url(#g)" stroke-width="5.2" stroke-linecap="round"/>
                            <path d="M62 14v10" stroke="url(#g)" stroke-width="5.2" stroke-linecap="round"/>

                            <text x="48" y="58" text-anchor="middle" font-family="Cinzel, serif" font-size="28" font-weight="800" fill="url(#g)">24</text>
                        </g>

                        <!-- gear -->
                        <g transform="translate(58,60)" filter="url(#gl)">
                            <path d="M18.5 8.8l-2-0.7c-0.2-0.6-0.5-1.2-0.9-1.7l1-1.9c0.2-0.4 0.1-0.9-0.2-1.2l-1.6-1.6c-0.3-0.3-0.8-0.4-1.2-0.2l-1.9 1c-0.5-0.4-1.1-0.7-1.7-0.9l-0.7-2C7.4 0.3 7 0 6.6 0H4.4C4 0 3.6 0.3 3.5 0.7l-0.7 2c-0.6 0.2-1.2 0.5-1.7 0.9l-1.9-1c-0.4-0.2-0.9-0.1-1.2 0.2L-3.6 4.4c-0.3 0.3-0.4 0.8-0.2 1.2l1 1.9c-0.4 0.5-0.7 1.1-0.9 1.7l-2 0.7C-6.3 10-6.6 10.4-6.6 10.8v2.2c0 0.4 0.3 0.8 0.7 0.9l2 0.7c0.2 0.6 0.5 1.2 0.9 1.7l-1 1.9c-0.2 0.4-0.1 0.9 0.2 1.2l1.6 1.6c0.3 0.3 0.8 0.4 1.2 0.2l1.9-1c0.5 0.4 1.1 0.7 1.7 0.9l0.7 2c0.1 0.4 0.5 0.7 0.9 0.7h2.2c0.4 0 0.8-0.3 0.9-0.7l0.7-2c0.6-0.2 1.2-0.5 1.7-0.9l1.9 1c0.4 0.2 0.9 0.1 1.2-0.2l1.6-1.6c0.3-0.3 0.4-0.8 0.2-1.2l-1-1.9c0.4-0.5 0.7-1.1 0.9-1.7l2-0.7c0.4-0.1 0.7-0.5 0.7-0.9v-2.2c0-0.4-0.3-0.8-0.7-0.9Z"
                                  fill="rgba(0,0,0,0.25)" stroke="url(#g)" stroke-width="2.4"/>
                            <circle cx="5.5" cy="12" r="4.6" fill="rgba(0,0,0,0.25)" stroke="url(#g)" stroke-width="2.2"/>
                        </g>
                    </svg>
                </div>
            </div>

            <div class="splash-hint">
                –ü—Ä–µ–º–∏–∞–ª—å–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–ª—è —Ñ–æ–∫—É—Å–Ω–∏–∫–∞
                <small>–°–æ–±–∏—Ä–∞—é –º–∞–≥–∏—é‚Ä¶</small>
            </div>

            <div class="splash-progress"><div></div></div>

            <!-- –º–∞–ª–µ–Ω—å–∫–∞—è "–∑–≤–µ–∑–¥–∞" –∫–∞–∫ –≤ —Ä–µ—Ñ–µ -->
            <svg class="splash-star" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                <path d="M32 6l6.2 16.8L55 29l-16.8 6.2L32 52l-6.2-16.8L9 29l16.8-6.2L32 6Z"
                      fill="rgba(245,158,11,0.28)" stroke="rgba(245,158,11,0.35)" stroke-width="1.2"/>
            </svg>
        </div>
    </div>
    <!-- /SPLASH -->

    <!-- Top Bar -->
    <header class="w-full max-w-lg p-6 flex justify-between items-center z-10 animate-enter">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-tr from-amber-500/20 to-transparent border border-amber-500/30 flex items-center justify-center shadow-lg shadow-amber-900/20">
                <i data-lucide="calculator" class="w-5 h-5 text-amber-500"></i>
            </div>
            <div>
                <h1 class="text-sm font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-200 to-amber-600 tracking-widest font-display">ILLUSIONIST OS</h1>
                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-[0.3em]">Smart Calc</p>
            </div>
        </div>
        <button onclick="App.toggleSettings()" class="btn-icon">
            <i data-lucide="settings" class="w-5 h-5"></i>
        </button>
    </header>

    <!-- Main Content -->
    <main class="w-full max-w-lg px-4 pb-24 z-10 flex-1 overflow-y-auto no-scrollbar">

        <!-- CALCULATOR VIEW -->
        <div id="view-calc" class="view-section active space-y-4 animate-enter" style="animation-delay: 0.1s;">

            <!-- Card: Client Info -->
            <div class="glass-panel p-5 space-y-4">
                <h3 class="text-xs font-bold text-slate-500 uppercase tracking-widest flex items-center gap-2 mb-2">
                    <i data-lucide="user" class="w-3 h-3 text-amber-500"></i> –ö–ª–∏–µ–Ω—Ç
                </h3>

                <div class="input-group flex items-center justify-between">
                    <span class="label-text">–ò–º—è</span>
                    <input type="text" id="inp-client" class="magic-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è...">
                </div>

                <div class="input-group flex items-center justify-between">
                    <span class="label-text">–¢–µ–ª–µ—Ñ–æ–Ω</span>
                    <input type="tel" id="inp-phone" class="magic-input" placeholder="8 (999)...">
                </div>

                <div class="input-group flex items-center justify-between">
                    <span class="label-text">–°–æ–±—ã—Ç–∏–µ</span>
                    <select id="inp-event-type" class="magic-select text-right">
                        <option value="–°–≤–∞–¥—å–±–∞">–°–≤–∞–¥—å–±–∞</option>
                        <option value="–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤">–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤</option>
                        <option value="–Æ–±–∏–ª–µ–π">–Æ–±–∏–ª–µ–π</option>
                        <option value="–î–µ—Ç—Å–∫–∏–π –ø—Ä–∞–∑–¥–Ω–∏–∫">–î–µ—Ç—Å–∫–∏–π –ø—Ä–∞–∑–¥–Ω–∏–∫</option>
                        <option value="–ß–∞—Å—Ç–Ω–æ–µ">–ß–∞—Å—Ç–Ω–æ–µ</option>
                        <option value="–í—ã–ø—É—Å–∫–Ω–æ–π">–í—ã–ø—É—Å–∫–Ω–æ–π</option>
                    </select>
                </div>
            </div>

            <!-- Card: Logistics -->
            <div class="glass-panel p-5 space-y-4">
                <h3 class="text-xs font-bold text-slate-500 uppercase tracking-widest flex items-center gap-2 mb-2">
                    <i data-lucide="map-pin" class="w-3 h-3 text-amber-500"></i> –õ–æ–≥–∏—Å—Ç–∏–∫–∞
                </h3>

                <div class="grid grid-cols-2 gap-3">
                    <div class="input-group flex flex-col justify-center">
                        <span class="label-text mb-1">–î–∞—Ç–∞</span>
                        <input type="date" id="inp-date" class="magic-input text-left" style="padding-top:0; padding-bottom:0;" onchange="App.updateDate()">
                    </div>
                    <div class="input-group flex flex-col justify-center">
                        <span class="label-text mb-1">–í—Ä–µ–º—è</span>
                        <input type="time" id="inp-time" class="magic-input text-left" style="padding-top:0; padding-bottom:0;" value="18:00">
                    </div>
                </div>

                <div id="holiday-alert" class="hidden bg-amber-500/10 border border-amber-500/20 text-amber-400 text-xs px-3 py-2 rounded-lg text-center font-bold">
                    üî• –ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π —Ç–∞—Ä–∏—Ñ (x<span id="holiday-k">1</span>)
                </div>

                <div class="input-group flex items-center justify-between">
                    <span class="label-text">–†–µ–≥–∏–æ–Ω</span>
                    <select id="inp-region" class="magic-select" onchange="App.updateRegion()"></select>
                </div>

                <div class="input-group flex items-center justify-between">
                    <span class="label-text">–ì–æ—Ä–æ–¥</span>
                    <select id="inp-city" class="magic-select" disabled onchange="App.calc()"></select>
                </div>
            </div>

            <!-- Card: Services -->
            <div class="glass-panel p-5 space-y-4">
                <h3 class="text-xs font-bold text-slate-500 uppercase tracking-widest flex items-center gap-2 mb-2">
                    <i data-lucide="sparkles" class="w-3 h-3 text-amber-500"></i> –£—Å–ª—É–≥–∏
                </h3>

                <div class="input-group flex items-center justify-between">
                    <span class="label-text">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</span>
                    <select id="inp-cat" class="magic-select" onchange="App.updateCat()"></select>
                </div>

                <div class="flex gap-2">
                    <div class="input-group flex-1 flex items-center justify-between">
                        <select id="inp-svc" class="magic-select text-left" disabled></select>
                    </div>
                    <div class="flex items-center bg-black/30 rounded-lg px-2 border border-white/10">
                         <button onclick="App.changeQty(-1)" class="w-8 h-full text-slate-400 hover:text-white font-bold text-lg">-</button>
                         <span id="svc-qty" class="w-6 text-center text-sm font-bold">1</span>
                         <button onclick="App.changeQty(1)" class="w-8 h-full text-amber-400 hover:text-white font-bold text-lg">+</button>
                    </div>
                </div>

                <button onclick="App.addService()" class="w-full py-3 rounded-xl border border-amber-500/30 text-amber-500 font-bold hover:bg-amber-500/10 transition text-sm flex items-center justify-center gap-2">
                    <i data-lucide="plus" class="w-4 h-4"></i> –î–æ–±–∞–≤–∏—Ç—å –≤ —Å–º–µ—Ç—É
                </button>

                <!-- Cart List -->
                <div id="cart-list" class="space-y-2 pt-2"></div>
            </div>

            <!-- Card: Extras -->
            <div class="glass-panel p-5 space-y-4">
                <h3 class="text-xs font-bold text-slate-500 uppercase tracking-widest flex items-center gap-2 mb-2">
                    <i data-lucide="wallet" class="w-3 h-3 text-amber-500"></i> –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
                </h3>

                <div class="flex gap-3">
                    <div class="input-group flex-1">
                        <input id="inp-manual-name" class="magic-input text-left" placeholder="–î–æ–ø. —Ä–∞—Å—Ö–æ–¥ (–Ω–∞–ø—Ä. —Ç–∞–∫—Å–∏)">
                    </div>
                    <div class="input-group w-24">
                        <input id="inp-manual-price" type="number" class="magic-input" placeholder="0 ‚ÇΩ" oninput="App.calc()">
                    </div>
                </div>

                <div class="input-group flex items-center justify-between">
                    <span class="label-text">–ì–æ—Å—Ç–∏</span>
                    <select id="inp-guests" class="magic-select" onchange="App.calc()">
                        <option value="0">–î–æ 50 —á–µ–ª–æ–≤–µ–∫ (0‚ÇΩ)</option>
                        <option value="5000">51‚Äì100 —á–µ–ª–æ–≤–µ–∫ (+5k)</option>
                        <option value="10000">101‚Äì200 —á–µ–ª–æ–≤–µ–∫ (+10k)</option>
                    </select>
                </div>
            </div>

            <!-- Total Panel -->
            <div class="glass-panel p-6 border-amber-500/20 shadow-[0_0_30px_rgba(245,158,11,0.1)] relative overflow-hidden">
                <div class="flex justify-between items-center mb-6 border-b border-white/5 pb-4">
                    <span class="text-sm font-medium text-slate-300">–î–æ–≥–æ–≤–æ—Ä (+6%)</span>
                    <label class="switch">
                        <input type="checkbox" id="inp-tax" onchange="App.calc()">
                        <span class="slider"></span>
                    </label>
                </div>

                <div id="discount-badge" class="hidden mb-2 text-center">
                    <span class="inline-block bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider">
                        ‚ú® –°–∫–∏–¥–∫–∞ –∑–∞ –æ–±—ä–µ–º 10%
                    </span>
                </div>

                <div id="bonus-list" class="flex flex-col gap-2 items-center mb-4 text-center empty:hidden">
                    <!-- Bonuses will appear here -->
                </div>

                <div class="text-center mb-6">
                    <div class="text-[10px] uppercase tracking-[0.2em] text-slate-500 font-bold mb-2">–ò—Ç–æ–≥–æ–≤–∞—è —Å–º–µ—Ç–∞</div>
                    <div id="total-sum" class="text-4xl md:text-5xl font-display font-bold text-transparent bg-clip-text bg-gradient-to-br from-amber-300 to-amber-600">0 ‚ÇΩ</div>
                </div>

                <button onclick="App.copyQuote()" class="btn-gold w-full py-4 rounded-xl text-sm uppercase tracking-wider flex items-center justify-center gap-2">
                    <i data-lucide="copy" class="w-4 h-4"></i> –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ö–ü
                </button>
            </div>
        </div>


        <!-- SETTINGS VIEW (Overlay) -->
        <div id="view-settings" class="modal-backdrop">
            <div class="modal-content glass-panel p-0 animate-enter flex flex-col h-full">
                <!-- Modal Header -->
                <div class="p-6 pb-2 shrink-0">
                    <div class="flex justify-between items-center mb-2">
                        <h2 class="text-xl font-display text-white">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                        <button onclick="App.toggleSettings()" class="text-slate-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
                    </div>
                    <p class="text-xs text-slate-500">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–µ–Ω, –≥–æ—Ä–æ–¥–æ–≤ –∏ —É—Å–ª—É–≥</p>
                </div>

                <!-- Modal Body (Scrollable) -->
                <div class="p-6 pt-2 flex-1 overflow-y-auto space-y-6">

                    <!-- Config Section -->
                    <div class="admin-section">
                        <h4 class="text-xs font-bold text-amber-500 uppercase tracking-widest mb-3">–ü—Ä–æ—Ñ–∏–ª—å</h4>
                        <div class="space-y-3">
                             <div class="input-group">
                                 <span class="label-text block mb-1">–ò–º—è –∞—Ä—Ç–∏—Å—Ç–∞</span>
                                 <input id="cfg-performer" class="magic-input text-left" placeholder="–î–º–∏—Ç—Ä–∏–π –ö–æ—Å—Ç—é–∫">
                             </div>
                             <div class="input-group flex justify-between items-center">
                                 <span class="label-text">–ó–∞–¥–∞—Ç–æ–∫ (%)</span>
                                 <input id="cfg-deposit" type="number" class="magic-input w-20" placeholder="30">
                             </div>
                        </div>
                    </div>

                    <!-- Bonuses Section (NEW) -->
                    <div class="admin-section">
                        <h4 class="text-xs font-bold text-amber-500 uppercase tracking-widest mb-3">–ë–æ–Ω—É—Å—ã –æ—Ç —Å—É–º–º—ã</h4>
                        <p class="text-[10px] text-slate-500 mb-2">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–¥–∞—Ä–∫–∏ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Å—É–º–º—ã.</p>
                        <div id="settings-bonuses-list" class="space-y-2 mb-3"></div>
                        <button onclick="Admin.addBonus()" class="btn-add-mini">+ –î–æ–±–∞–≤–∏—Ç—å –±–æ–Ω—É—Å</button>
                    </div>

                    <!-- Logistics Editor -->
                    <div class="admin-section">
                        <h4 class="text-xs font-bold text-amber-500 uppercase tracking-widest mb-3">–õ–æ–≥–∏—Å—Ç–∏–∫–∞</h4>
                        <div id="settings-travel-list" class="space-y-2"></div>
                        <button onclick="Admin.addRegion()" class="btn-add-mini mt-2">+ –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–≥–∏–æ–Ω</button>
                    </div>

                    <!-- Services Editor -->
                    <div class="admin-section">
                        <h4 class="text-xs font-bold text-amber-500 uppercase tracking-widest mb-3">–£—Å–ª—É–≥–∏</h4>
                        <div id="settings-services-list" class="space-y-2"></div>
                        <button onclick="Admin.addCategory()" class="btn-add-mini mt-2">+ –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                    </div>

                    <!-- Holidays Editor -->
                    <div class="admin-section">
                        <h4 class="text-xs font-bold text-amber-500 uppercase tracking-widest mb-3">–ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã</h4>
                        <p class="text-[10px] text-slate-500 mb-2">–î–∞—Ç—ã (–ú–ú-–î–î) –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω—ã. –ö = –º–Ω–æ–∂–∏—Ç–µ–ª—å —Ü–µ–Ω—ã.</p>

                        <div id="settings-holidays-list" class="space-y-1 mb-3"></div>
                        <button onclick="Admin.addHoliday()" class="btn-add-mini mb-4">+ –î–æ–±–∞–≤–∏—Ç—å –¥–∞—Ç—É</button>

                        <div id="settings-ranges-list" class="space-y-1 mb-2"></div>
                        <button onclick="Admin.addRange()" class="btn-add-mini">+ –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–∏–æ–¥</button>
                    </div>

                     <!-- Quote Details -->
                     <div class="admin-section">
                        <h4 class="text-xs font-bold text-amber-500 uppercase tracking-widest mb-3">–†–µ–∫–≤–∏–∑–∏—Ç—ã –∏ –°—Å—ã–ª–∫–∏</h4>
                        <div id="settings-payments-list" class="space-y-2 mb-4"></div>
                        <button onclick="Admin.addPayment()" class="btn-add-mini mb-4">+ –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∫–≤–∏–∑–∏—Ç—ã</button>

                        <div id="settings-links-list" class="space-y-2"></div>
                        <button onclick="Admin.addLink()" class="btn-add-mini mt-2">+ –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É</button>
                    </div>

                    <!-- Reset -->
                    <div class="pt-4">
                        <button onclick="Admin.reset()" class="w-full py-3 rounded-lg border border-red-500/30 text-red-400 hover:bg-red-500/10 font-bold text-xs uppercase transition">–°–±—Ä–æ—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</button>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-6 left-1/2 -translate-x-1/2 bg-slate-900 border border-amber-500/30 text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 transition-all duration-300 opacity-0 -translate-y-4 pointer-events-none z-50">
        <i data-lucide="sparkles" class="w-4 h-4 text-amber-500"></i>
        <span id="toast-msg" class="text-sm font-bold">–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!</span>
    </div>

    <script>
        // --- DEFAULT DB STRUCTURE ---
        const DEFAULT_DB = {
            travel: {
                "–Ø—Ä–æ—Å–ª–∞–≤—Å–∫–∞—è": { fee: 1000, cities: {"–Ø—Ä–æ—Å–ª–∞–≤–ª—å": 0, "–†—ã–±–∏–Ω—Å–∫": 2000, "–¢—É—Ç–∞–µ–≤": 2000, "–£–≥–ª–∏—á": 2000, "–†–æ—Å—Ç–æ–≤": 2000, "–ü–µ—Ä–µ—Å–ª–∞–≤–ª—å-–ó–∞–ª–µ—Å—Å–∫–∏–π": 2000, "–ì–∞–≤—Ä–∏–ª–æ–≤-–Ø–º": 2000, "–î–∞–Ω–∏–ª–æ–≤": 2000, "–ü–æ—à–µ—Ö–æ–Ω—å–µ": 4000, "–ú—ã—à–∫–∏–Ω": 2000, "–õ—é–±–∏–º": 2000} },
                "–ö–æ—Å—Ç—Ä–æ–º—Å–∫–∞—è": { fee: 3000, cities: {"–ö–æ—Å—Ç—Ä–æ–º–∞": 2000, "–í–æ–ª–≥–æ—Ä–µ—á–µ–Ω—Å–∫": 2000, "–ë—É–π": 3000, "–ù–µ—Ä–µ—Ö—Ç–∞": 2000, "–®–∞—Ä—å—è": 6000, "–ú–∞–Ω—Ç—É—Ä–æ–≤–æ": 5500, "–ì–∞–ª–∏—á": 3500} },
                "–ò–≤–∞–Ω–æ–≤—Å–∫–∞—è": { fee: 5000, cities: {"–ò–≤–∞–Ω–æ–≤–æ": 2000, "–ü–ª–µ—Å": 3000, "–ö–∏–Ω–µ—à–º–∞": 3500, "–®—É—è": 3000, "–¢–µ–π–∫–æ–≤–æ": 2500, "–ö–æ—Ö–º–∞": 2500, "–í–∏—á—É–≥–∞": 3000, "–§—É—Ä–º–∞–Ω–æ–≤": 2500, "–†–æ–¥–Ω–∏–∫–∏": 3000, "–ü—Ä–∏–≤–æ–ª–∂—Å–∫": 2000, "–Æ–∂–∞": 4000} },
                "–í–ª–∞–¥–∏–º–∏—Ä—Å–∫–∞—è": { fee: 10000, cities: {"–í–ª–∞–¥–∏–º–∏—Ä": 10000, "–°—É–∑–¥–∞–ª—å": 10000, "–ö–æ–≤—Ä–æ–≤": 10000, "–ú—É—Ä–æ–º": 17000, "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤": 10000, "–ì—É—Å—å-–•—Ä—É—Å—Ç–∞–ª—å–Ω—ã–π": 13500} },
                "–í–æ–ª–æ–≥–æ–¥—Å–∫–∞—è": { fee: 9000, cities: {"–í–æ–ª–æ–≥–¥–∞": 9000, "–ß–µ—Ä–µ–ø–æ–≤–µ—Ü": 15000, "–°–æ–∫–æ–ª": 12000} },
                "–ú–æ—Å–∫–≤–∞ –∏ –ú–û": { fee: 15000, cities: {"–ú–æ—Å–∫–≤–∞": 15000, "–•–∏–º–∫–∏": 15000, "–ë–∞–ª–∞—à–∏—Ö–∞": 15000} }
            },
            services: {
                "–î–µ—Ç—Å–∫–∏–µ —à–æ—É": { "–î–µ—Ç—Å–∫–æ–µ —à–æ—É (30 –º–∏–Ω)": 11250, "–î–µ—Ç—Å–∫–æ–µ —à–æ—É (40 –º–∏–Ω)": 13750, "–ò–Ω–¥–∏–≤. –¥–µ—Ç—Å–∫–æ–µ —à–æ—É": 21250 },
                "–í–∑—Ä–æ—Å–ª—ã–µ —à–æ—É": { "–®–æ—É (20 –º–∏–Ω)": 17500, "–®–æ—É (30 –º–∏–Ω)": 23750, "–®–æ—É (40 –º–∏–Ω)": 30000 },
                "–ú–∏–∫—Ä–æ–º–∞–≥–∏—è": { "–ú–∏–∫—Ä–æ–º–∞–≥–∏—è (30 –º–∏–Ω)": 13000, "–ú–∏–∫—Ä–æ–º–∞–≥–∏—è (1 —á)": 20000, "–ú–∏–∫—Ä–æ–º–∞–≥–∏—è (2 —á)": 30000, "–ú–∏–∫—Ä–æ–º–∞–≥–∏—è (3 —á)": 36000 },
                "–°–ø–µ—Ü-–ø—Ä–æ–µ–∫—Ç—ã": { "–°–≤–∞–¥—å–±–∞ (20 –º–∏–Ω)": 26250, "–°–≤–∞–¥—å–±–∞ (30 –º–∏–Ω)": 32500, "–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤ (20 –º–∏–Ω)": 26250, "–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤ (30 –º–∏–Ω)": 32500, "–Æ–±–∏–ª–µ–π (20 –º–∏–Ω)": 23750, "–Æ–±–∏–ª–µ–π (30 –º–∏–Ω)": 30000, "–í—ã–ø—É—Å–∫–Ω–æ–π (20 –º–∏–Ω)": 23750, "–í—ã–ø—É—Å–∫–Ω–æ–π (30 –º–∏–Ω)": 30000 },
                "–ö–æ–Ω—Ü–µ—Ä—Ç—ã": { "–ú–∏–Ω–∏-—à–æ—É –°–ï–ö–†–ï–¢ (1 —á)": 150000, "–°–ø–µ–∫—Ç–∞–∫–ª—å –°–ï–ö–†–ï–¢ (2 —á)": 300000 }
            },
            holidays: {"12-31": 2.0, "01-01": 2.0, "02-23": 1.5, "03-08": 1.5},
            holidayRanges: [{sm:12, sd:15, em:12, ed:30, k:1.5}],
            bonuses: [
                { threshold: 15000, text: "üéÅ 2 –±–∏–ª–µ—Ç–∞ –Ω–∞ —à–æ—É" },
                { threshold: 30000, text: "üé© –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–æ–∫—É—Å –≤ –ø–æ–¥–∞—Ä–æ–∫" }
            ],
            payments: [{ title: "–¢-–ë–∞–Ω–∫", text: "8 909 276 33 86\n–î–º–∏—Ç—Ä–∏–π –ü–∞–≤–ª–æ–≤–∏—á –ö." }],
            links: [{ label: "–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ", url: "" }],
            config: { performer: "Illusionist", deposit: 30 }
        };

        let DB = {};
        let State = { date: new Date().toISOString().split('T')[0], cart: [], serviceQty: 1, holidayK: 1, activeBonuses: [] };

        // SPLASH (NEW)
        const Splash = {
            minMs: 3600, // –¥–æ–ª—å—à–µ –∏ –ø—Ä–µ–º–∏–∞–ª—å–Ω–µ–µ
            shownAt: 0,
            start: () => {
                const el = document.getElementById('splash');
                if (!el) return;
                Splash.shownAt = performance.now();
                el.classList.remove('hide');
            },
            finishWhenReady: () => {
                const el = document.getElementById('splash');
                if (!el) return;

                const fontsReady = (document.fonts && document.fonts.ready) ? document.fonts.ready.catch(() => {}) : Promise.resolve();

                Promise.all([fontsReady]).then(() => {
                    const elapsed = performance.now() - Splash.shownAt;
                    const remaining = Math.max(0, Splash.minMs - elapsed);

                    setTimeout(() => {
                        el.classList.add('hide');
                        setTimeout(() => el.remove(), 650);
                    }, remaining);
                });
            }
        };

        // --- APP LOGIC ---
        const App = {
            init: () => {
                Storage.load();
                App.renderParticles();
                App.updateUI();

                // Bind Config Inputs
                const pInp = document.getElementById('cfg-performer');
                if(pInp) {
                    pInp.value = DB.config.performer;
                    pInp.oninput = () => { DB.config.performer = pInp.value; Storage.save(); };
                }
                const dInp = document.getElementById('cfg-deposit');
                if(dInp) {
                    dInp.value = DB.config.deposit;
                    dInp.oninput = () => { DB.config.deposit = parseInt(dInp.value)||30; Storage.save(); };
                }

                document.getElementById('inp-date').value = State.date;
                App.updateDate();
                lucide.createIcons();
            },

            updateUI: () => {
                // Populate Regions
                const rSel = document.getElementById('inp-region');
                const currentR = rSel.value;
                rSel.innerHTML = '<option disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ...</option>';
                for(let r in DB.travel) rSel.add(new Option(r, r));
                if(currentR && DB.travel[currentR]) rSel.value = currentR;

                // Populate Categories
                const cSel = document.getElementById('inp-cat');
                const currentC = cSel.value;
                cSel.innerHTML = '<option disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ...</option>';
                for(let c in DB.services) cSel.add(new Option(c, c));
                if(currentC && DB.services[currentC]) cSel.value = currentC;
            },

            updateDate: () => {
                const val = document.getElementById('inp-date').value;
                if(!val) return;
                State.date = val;

                const [y,m,d] = val.split('-').map(Number);
                const key = `${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`;

                let k = DB.holidays[key] || 1;

                // Check Ranges if not exact date match
                if (k === 1 && DB.holidayRanges) {
                    const md = m * 100 + d;
                    for(let r of DB.holidayRanges) {
                        const start = r.sm * 100 + r.sd;
                        const end = r.em * 100 + r.ed;
                        const inRange = start <= end ? (md >= start && md <= end) : (md >= start || md <= end);
                        if(inRange) { k = r.k; break; }
                    }
                }

                State.holidayK = k;
                const badge = document.getElementById('holiday-alert');
                const kSpan = document.getElementById('holiday-k');

                if(k > 1) {
                    badge.classList.remove('hidden');
                    kSpan.innerText = k;
                } else {
                    badge.classList.add('hidden');
                }
                App.calc();
            },

            updateRegion: () => {
                const r = document.getElementById('inp-region').value;
                const cSel = document.getElementById('inp-city');
                cSel.innerHTML = '';
                cSel.disabled = false;

                if(DB.travel[r]) {
                    for(let c in DB.travel[r].cities) cSel.add(new Option(c, c));
                    cSel.add(new Option("–î—Ä—É–≥–æ–π", "other"));
                }
                App.calc();
            },

            updateCat: () => {
                const c = document.getElementById('inp-cat').value;
                const sSel = document.getElementById('inp-svc');
                sSel.innerHTML = '';
                sSel.disabled = false;

                if(DB.services[c]) {
                    for(let s in DB.services[c]) sSel.add(new Option(s, s));
                }
            },

            changeQty: (delta) => {
                let n = State.serviceQty + delta;
                if(n < 1) n = 1;
                State.serviceQty = n;
                document.getElementById('svc-qty').innerText = n;
            },

            addService: () => {
                const cat = document.getElementById('inp-cat').value;
                const svc = document.getElementById('inp-svc').value;
                if(!cat || !svc) return App.showToast('–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É!');

                const basePrice = DB.services[cat][svc];
                State.cart.push({ name: svc, price: basePrice, qty: State.serviceQty });

                State.serviceQty = 1;
                document.getElementById('svc-qty').innerText = 1;

                App.renderCart();
                App.calc();
                App.showToast('–£—Å–ª—É–≥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞');
            },

            removeService: (idx) => {
                State.cart.splice(idx, 1);
                App.renderCart();
                App.calc();
            },

            renderCart: () => {
                const list = document.getElementById('cart-list');
                list.innerHTML = '';

                State.cart.forEach((item, idx) => {
                    const total = item.price * item.qty * State.holidayK;
                    list.innerHTML += `
                        <div class="flex justify-between items-center bg-white/5 p-3 rounded-xl border border-white/5 animate-enter">
                            <div>
                                <div class="text-sm font-medium text-white">${item.name} ${item.qty > 1 ? `<span class="text-amber-500 text-xs">x${item.qty}</span>` : ''}</div>
                                <div class="text-xs text-slate-400 font-mono">${item.price.toLocaleString()} ‚ÇΩ</div>
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="font-bold text-amber-400 text-sm font-mono">${total.toLocaleString()} ‚ÇΩ</span>
                                <button onclick="App.removeService(${idx})" class="text-slate-600 hover:text-red-400"><i data-lucide="x" class="w-4 h-4"></i></button>
                            </div>
                        </div>
                    `;
                });
                lucide.createIcons();
            },

            calc: () => {
                const k = State.holidayK;
                let sTot = 0;
                State.cart.forEach(i => sTot += i.price * i.qty * k);

                let discount = 0;
                if(State.cart.length > 1) {
                    discount = Math.round(sTot * 0.1);
                    document.getElementById('discount-badge').classList.remove('hidden');
                } else {
                    document.getElementById('discount-badge').classList.add('hidden');
                }
                sTot -= discount;

                const reg = document.getElementById('inp-region').value;
                const cit = document.getElementById('inp-city').value;
                let travel = 0;
                if(reg && cit && DB.travel[reg]) {
                    const base = cit === 'other' ? DB.travel[reg].fee : DB.travel[reg].cities[cit];
                    travel = Math.round(base * (k > 1 ? 1.5 : 1));
                }

                const manPrice = parseInt(document.getElementById('inp-manual-price').value) || 0;
                const guestPrice = parseInt(document.getElementById('inp-guests').value) || 0;

                let preTax = sTot + travel + manPrice + guestPrice;
                const useTax = document.getElementById('inp-tax').checked;
                const tax = useTax ? Math.round(preTax * 0.06) : 0;

                State.finalTotal = preTax + tax;
                State.finalDetails = { sTot, discount, travel, manPrice, guestPrice, tax, k };

                document.getElementById('total-sum').innerText = State.finalTotal.toLocaleString() + ' ‚ÇΩ';

                // Check Bonuses
                State.activeBonuses = [];
                if(DB.bonuses && DB.bonuses.length > 0) {
                    State.activeBonuses = DB.bonuses.filter(b => State.finalTotal >= b.threshold);
                }

                const bonusListEl = document.getElementById('bonus-list');
                bonusListEl.innerHTML = '';
                if(State.activeBonuses.length > 0) {
                    State.activeBonuses.forEach(b => {
                        bonusListEl.innerHTML += `
                        <div class="inline-block bg-amber-500/10 text-amber-400 border border-amber-500/20 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider animate-enter">
                           ${b.text}
                        </div>`;
                    });
                }
            },

            copyQuote: () => {
                if(!State.finalTotal) return App.showToast('–°—É–º–º–∞ 0 ‚ÇΩ');

                const client = document.getElementById('inp-client').value || '–ö–ª–∏–µ–Ω—Ç';
                const type = document.getElementById('inp-event-type').value;
                const dateRaw = document.getElementById('inp-date').value;
                const dateFmt = new Date(dateRaw).toLocaleDateString('ru-RU', {day:'numeric', month:'long', weekday:'short'});
                const time = document.getElementById('inp-time').value;
                const city = document.getElementById('inp-city').value || '';
                const depPct = DB.config.deposit || 30;
                const deposit = Math.round(State.finalTotal * (depPct/100));

                let text = `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, ${client}!\n\n`;
                text += `‚ú® **–†–ê–°–ß–ï–¢: ${type.toUpperCase()}** ‚ú®\n`;
                text += `üìÖ ${dateFmt} / ${time}\n`;
                if(city && city!=='other') text += `üìç ${city}\n`;
                text += `\nüé© **–ü—Ä–æ–≥—Ä–∞–º–º–∞:**\n`;

                State.cart.forEach(i => {
                    const price = Math.round(i.price * i.qty * State.finalDetails.k);
                    text += `‚Ä¢ ${i.name} ‚Äî ${price.toLocaleString()} ‚ÇΩ\n`;
                });

                if(State.finalDetails.discount > 0) text += `üéÅ –°–∫–∏–¥–∫–∞ 10%: -${State.finalDetails.discount.toLocaleString()} ‚ÇΩ\n`;
                if(State.finalDetails.travel > 0) text += `üöï –õ–æ–≥–∏—Å—Ç–∏–∫–∞: ${State.finalDetails.travel.toLocaleString()} ‚ÇΩ\n`;
                if(State.finalDetails.guestPrice > 0) text += `üë• –î–æ–ø–ª–∞—Ç–∞ –∑–∞ –≥–æ—Å—Ç–µ–π: ${State.finalDetails.guestPrice.toLocaleString()} ‚ÇΩ\n`;
                if(State.finalDetails.manPrice > 0) text += `üîπ –î–æ–ø: ${State.finalDetails.manPrice.toLocaleString()} ‚ÇΩ\n`;
                if(State.finalDetails.tax > 0) text += `üìÑ –î–æ–≥–æ–≤–æ—Ä (+6%): ${State.finalDetails.tax.toLocaleString()} ‚ÇΩ\n`;

                if(State.activeBonuses.length > 0) {
                     text += `\nüéÅ **–í–ê–®–ò –ë–û–ù–£–°–´:**\n`;
                     State.activeBonuses.forEach(b => text += `‚úÖ ${b.text}\n`);
                }

                text += `\nüí∞ **–ò–¢–û–ì–û: ${State.finalTotal.toLocaleString()} ‚ÇΩ**\n`;
                text += `üí≥ –ë—Ä–æ–Ω—å –¥–∞—Ç—ã (${depPct}%): ${deposit.toLocaleString()} ‚ÇΩ\n`;

                if(DB.payments && DB.payments.length > 0) {
                    text += `\nüì≤ **–†–µ–∫–≤–∏–∑–∏—Ç—ã:**\n`;
                    DB.payments.forEach(p => text += `${p.title}: ${p.text}\n`);
                }

                if(DB.links && DB.links.length > 0) {
                    text += `\nüîó **–°—Å—ã–ª–∫–∏:**\n`;
                    DB.links.forEach(l => text += `‚Ä¢ ${l.label}: ${l.url}\n`);
                }

                text += `\n–í–∞—à ${DB.config.performer}`;

                navigator.clipboard.writeText(text).then(() => {
                    App.showToast('–ö–ü —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!');
                });
            },

            toggleSettings: () => {
                const modal = document.getElementById('view-settings');
                const isOpen = modal.classList.contains('active');
                if(!isOpen) {
                     Admin.render();
                     modal.classList.add('active');
                } else {
                     modal.classList.remove('active');
                     App.updateUI(); // Refresh main view dropdowns
                }
            },

            showToast: (msg) => {
                const t = document.getElementById('toast');
                document.getElementById('toast-msg').innerText = msg;
                t.classList.remove('opacity-0', '-translate-y-4');
                t.classList.add('opacity-100', 'translate-y-0');
                setTimeout(() => {
                    t.classList.add('opacity-0', '-translate-y-4');
                    t.classList.remove('opacity-100', 'translate-y-0');
                }, 2000);
            },

            renderParticles: () => {
                const canvas = document.getElementById('bg-canvas');
                const ctx = canvas.getContext('2d');
                let particles = [];
                const resize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
                window.addEventListener('resize', resize);
                resize();
                for(let i=0; i<40; i++) {
                    particles.push({
                        x: Math.random() * canvas.width, y: Math.random() * canvas.height,
                        r: Math.random() * 2, d: Math.random() * Math.PI * 2,
                        s: Math.random() * 0.5 + 0.1, c: Math.random() > 0.5 ? '#f59e0b' : '#64748b'
                    });
                }
                function animate() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    particles.forEach(p => {
                        p.x += Math.cos(p.d) * p.s; p.y += Math.sin(p.d) * p.s;
                        if(p.x < 0) p.x = canvas.width; if(p.x > canvas.width) p.x = 0;
                        if(p.y < 0) p.y = canvas.height; if(p.y > canvas.height) p.y = 0;
                        ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
                        ctx.fillStyle = p.c; ctx.globalAlpha = 0.3; ctx.fill();
                    });
                    requestAnimationFrame(animate);
                }
                animate();
            }
        };

        const Admin = {
            render: () => {
                // LOGISTICS
                const tDiv = document.getElementById('settings-travel-list');
                tDiv.innerHTML = '';
                for (let r in DB.travel) {
                    const cities = DB.travel[r].cities;
                    let cHtml = '';
                    for(let c in cities) {
                        cHtml += `
                        <div class="edit-row ml-4">
                            <input class="edit-input" value="${c}" onchange="Admin.renameCity('${r}','${c}',this.value)">
                            <input type="number" class="edit-input w-24 text-right" value="${cities[c]}" onchange="Admin.setCityPrice('${r}','${c}',this.value)">
                            <button onclick="Admin.delCity('${r}','${c}')" class="btn-del-mini"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        </div>`;
                    }
                    tDiv.innerHTML += `
                    <div class="bg-white/5 rounded-lg p-3 mb-2">
                        <div class="admin-header" onclick="Admin.toggleSection(this)">
                            <span class="font-bold text-sm text-amber-500">${r}</span>
                            <i data-lucide="chevron-down" class="w-4 h-4 text-slate-500 transition-transform"></i>
                        </div>
                        <div class="admin-content">
                             <div class="edit-row mb-3 pb-3 border-b border-white/5">
                                <span class="text-xs text-slate-400 w-full">–ë–∞–∑–∞:</span>
                                <input type="number" class="edit-input w-24 text-right" value="${DB.travel[r].fee}" onchange="Admin.setRegionFee('${r}',this.value)">
                            </div>
                            ${cHtml}
                            <button onclick="Admin.addCity('${r}')" class="btn-add-mini mt-1 text-xs">+ –ì–æ—Ä–æ–¥</button>
                            <button onclick="Admin.delRegion('${r}')" class="text-[10px] text-red-400 mt-3 w-full text-right opacity-50 hover:opacity-100">–£–¥–∞–ª–∏—Ç—å —Ä–µ–≥–∏–æ–Ω</button>
                        </div>
                    </div>`;
                }

                // SERVICES
                const sDiv = document.getElementById('settings-services-list');
                sDiv.innerHTML = '';
                for (let c in DB.services) {
                    let sHtml = '';
                    for(let s in DB.services[c]) {
                        sHtml += `
                        <div class="edit-row ml-4">
                            <input class="edit-input" value="${s}" onchange="Admin.renameSvc('${c}','${s}',this.value)">
                            <input type="number" class="edit-input w-24 text-right" value="${DB.services[c][s]}" onchange="Admin.setSvcPrice('${c}','${s}',this.value)">
                            <button onclick="Admin.delSvc('${c}','${s}')" class="btn-del-mini"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        </div>`;
                    }
                    sDiv.innerHTML += `
                    <div class="bg-white/5 rounded-lg p-3 mb-2">
                        <div class="admin-header" onclick="Admin.toggleSection(this)">
                            <span class="font-bold text-sm text-purple-400">${c}</span>
                            <i data-lucide="chevron-down" class="w-4 h-4 text-slate-500 transition-transform"></i>
                        </div>
                        <div class="admin-content">
                            ${sHtml}
                            <button onclick="Admin.addSvc('${c}')" class="btn-add-mini mt-1 text-xs">+ –£—Å–ª—É–≥–∞</button>
                            <button onclick="Admin.delCat('${c}')" class="text-[10px] text-red-400 mt-3 w-full text-right opacity-50 hover:opacity-100">–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                        </div>
                    </div>`;
                }

                // HOLIDAYS
                const hDiv = document.getElementById('settings-holidays-list');
                hDiv.innerHTML = '';
                Object.keys(DB.holidays).sort().forEach(key => {
                     hDiv.innerHTML += `
                     <div class="edit-row">
                        <input class="edit-input text-center" value="${key}" placeholder="MM-DD" onchange="Admin.updateHolidayKey('${key}', this.value)">
                        <input class="edit-input w-20 text-center text-amber-400 font-bold" value="${DB.holidays[key]}" onchange="Admin.updateHolidayVal('${key}', this.value)">
                        <button onclick="Admin.delHoliday('${key}')" class="btn-del-mini"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                     </div>`;
                });

                const rDiv = document.getElementById('settings-ranges-list');
                rDiv.innerHTML = '';
                if(DB.holidayRanges) {
                    DB.holidayRanges.forEach((r, i) => {
                         const start = `${String(r.sm).padStart(2,'0')}-${String(r.sd).padStart(2,'0')}`;
                         const end = `${String(r.em).padStart(2,'0')}-${String(r.ed).padStart(2,'0')}`;
                         rDiv.innerHTML += `
                         <div class="edit-row">
                            <input class="edit-input text-center text-xs px-1" value="${start}" onchange="Admin.updateRange(${i}, 'start', this.value)">
                            <span class="text-slate-500">‚Üí</span>
                            <input class="edit-input text-center text-xs px-1" value="${end}" onchange="Admin.updateRange(${i}, 'end', this.value)">
                            <input class="edit-input w-16 text-center text-amber-400 font-bold" value="${r.k}" onchange="Admin.updateRange(${i}, 'k', this.value)">
                            <button onclick="Admin.delRange(${i})" class="btn-del-mini"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                         </div>`;
                    });
                }

                // BONUSES
                const bDiv = document.getElementById('settings-bonuses-list');
                bDiv.innerHTML = '';
                if(DB.bonuses) {
                    DB.bonuses.forEach((b, i) => {
                        bDiv.innerHTML += `
                        <div class="edit-row">
                            <span class="text-xs text-slate-500 w-8">–û—Ç</span>
                            <input type="number" class="edit-input w-24" value="${b.threshold}" placeholder="–°—É–º–º–∞" onchange="Admin.updateBonus(${i}, 'threshold', this.value)">
                            <input class="edit-input flex-1" value="${b.text}" placeholder="–¢–µ–∫—Å—Ç –±–æ–Ω—É—Å–∞" onchange="Admin.updateBonus(${i}, 'text', this.value)">
                            <button onclick="Admin.delBonus(${i})" class="btn-del-mini"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        </div>`;
                    });
                }

                // PAYMENTS & LINKS
                const payDiv = document.getElementById('settings-payments-list');
                payDiv.innerHTML = '';
                if(DB.payments) {
                    DB.payments.forEach((p, i) => {
                        payDiv.innerHTML += `
                        <div class="bg-white/5 rounded-lg p-2 mb-2 relative group">
                            <input class="bg-transparent text-amber-500 font-bold text-xs w-full mb-1 outline-none" value="${p.title}" oninput="Admin.updatePayment(${i}, 'title', this.value)">
                            <textarea class="bg-transparent text-slate-300 text-xs w-full outline-none resize-none h-auto" rows="1" oninput="Admin.updatePayment(${i}, 'text', this.value)">${p.text}</textarea>
                            <button onclick="Admin.delPayment(${i})" class="absolute top-2 right-2 btn-del-mini opacity-0 group-hover:opacity-100 transition"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        </div>`;
                    });
                }

                const linkDiv = document.getElementById('settings-links-list');
                linkDiv.innerHTML = '';
                if(DB.links) {
                    DB.links.forEach((l, i) => {
                         linkDiv.innerHTML += `
                         <div class="edit-row">
                            <input class="edit-input w-1/3" value="${l.label}" oninput="Admin.updateLink(${i}, 'label', this.value)">
                            <input class="edit-input flex-1" value="${l.url}" placeholder="https://..." oninput="Admin.updateLink(${i}, 'url', this.value)">
                            <button onclick="Admin.delLink(${i})" class="btn-del-mini"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                         </div>`;
                    });
                }

                lucide.createIcons();
            },

            // HELPERS
            toggleSection: (el) => {
                const content = el.nextElementSibling;
                const icon = el.querySelector('i');
                content.classList.toggle('open');
                icon.style.transform = content.classList.contains('open') ? 'rotate(180deg)' : 'rotate(0)';
            },

            // --- LOGISTICS ---
            addRegion: () => { const n = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–∞:"); if(n && !DB.travel[n]) { DB.travel[n]={fee:0, cities:{}}; Storage.save(); Admin.render(); } },
            delRegion: (r) => { if(confirm(`–£–¥–∞–ª–∏—Ç—å ${r}?`)) { delete DB.travel[r]; Storage.save(); Admin.render(); } },
            setRegionFee: (r,v) => { DB.travel[r].fee=parseInt(v)||0; Storage.save(); },
            addCity: (r) => { const n = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞:"); if(n) { DB.travel[r].cities[n]=0; Storage.save(); Admin.render(); } },
            delCity: (r,c) => { delete DB.travel[r].cities[c]; Storage.save(); Admin.render(); },
            renameCity: (r,oldC,newC) => { if(oldC===newC || !newC) return; const p = DB.travel[r].cities[oldC]; delete DB.travel[r].cities[oldC]; DB.travel[r].cities[newC] = p; Storage.save(); },
            setCityPrice: (r,c,v) => { DB.travel[r].cities[c]=parseInt(v)||0; Storage.save(); },

            // --- SERVICES ---
            addCategory: () => { const n = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:"); if(n && !DB.services[n]) { DB.services[n]={}; Storage.save(); Admin.render(); } },
            delCat: (c) => { if(confirm(`–£–¥–∞–ª–∏—Ç—å ${c}?`)) { delete DB.services[c]; Storage.save(); Admin.render(); } },
            addSvc: (c) => { const n = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏:"); if(n) { DB.services[c][n]=0; Storage.save(); Admin.render(); } },
            delSvc: (c,s) => { delete DB.services[c][s]; Storage.save(); Admin.render(); },
            renameSvc: (c,oldS,newS) => { if(oldS===newS || !newS) return; const p = DB.services[c][oldS]; delete DB.services[c][oldS]; DB.services[c][newS] = p; Storage.save(); },
            setSvcPrice: (c,s,v) => { DB.services[c][s]=parseInt(v)||0; Storage.save(); },

            // --- HOLIDAYS ---
            addHoliday: () => { const d = prompt("–î–∞—Ç–∞ (–ú–ú-–î–î):", "12-31"); if(d) { DB.holidays[d]=1.5; Storage.save(); Admin.render(); } },
            delHoliday: (k) => { delete DB.holidays[k]; Storage.save(); Admin.render(); },
            updateHolidayKey: (oldK, newK) => { if(oldK===newK) return; const v=DB.holidays[oldK]; delete DB.holidays[oldK]; DB.holidays[newK]=v; Storage.save(); Admin.render(); },
            updateHolidayVal: (k, v) => { DB.holidays[k]=parseFloat(v)||1; Storage.save(); },

            addRange: () => { if(!DB.holidayRanges) DB.holidayRanges=[]; DB.holidayRanges.push({sm:12, sd:20, em:12, ed:30, k:1.5}); Storage.save(); Admin.render(); },
            delRange: (i) => { DB.holidayRanges.splice(i, 1); Storage.save(); Admin.render(); },
            updateRange: (i, field, val) => {
                const r = DB.holidayRanges[i];
                if(field==='k') r.k = parseFloat(val)||1;
                else {
                    const [m,d] = val.split('-').map(Number);
                    if(m && d) {
                        if(field==='start') { r.sm=m; r.sd=d; }
                        if(field==='end') { r.em=m; r.ed=d; }
                    }
                }
                Storage.save();
            },

            // --- BONUSES (NEW) ---
            addBonus: () => { if(!DB.bonuses) DB.bonuses=[]; DB.bonuses.push({threshold: 10000, text: "–ë–æ–Ω—É—Å"}); Storage.save(); Admin.render(); },
            delBonus: (i) => { DB.bonuses.splice(i, 1); Storage.save(); Admin.render(); },
            updateBonus: (i, field, val) => {
                if(field === 'threshold') DB.bonuses[i].threshold = parseInt(val) || 0;
                else DB.bonuses[i].text = val;
                Storage.save();
            },

            // --- EXTRAS ---
            addPayment: () => { if(!DB.payments) DB.payments=[]; DB.payments.push({title:"–ë–∞–Ω–∫", text:""}); Storage.save(); Admin.render(); },
            delPayment: (i) => { DB.payments.splice(i,1); Storage.save(); Admin.render(); },
            updatePayment: (i, f, v) => { DB.payments[i][f]=v; Storage.save(); },

            addLink: () => { if(!DB.links) DB.links=[]; DB.links.push({label:"–°–∞–π—Ç", url:""}); Storage.save(); Admin.render(); },
            delLink: (i) => { DB.links.splice(i,1); Storage.save(); Admin.render(); },
            updateLink: (i, f, v) => { DB.links[i][f]=v; Storage.save(); },

            reset: () => {
                if(confirm('–°–±—Ä–æ—Å–∏—Ç—å –±–∞–∑—É —Ü–µ–Ω –∫ –∑–∞–≤–æ–¥—Å–∫–∏–º?')) {
                    localStorage.removeItem('illusionist_calc_db');
                    location.reload();
                }
            }
        };

        const Storage = {
            save: () => localStorage.setItem('illusionist_calc_db', JSON.stringify(DB)),
            load: () => {
                const s = localStorage.getItem('illusionist_calc_db');
                if(s) {
                    try { DB = { ...DEFAULT_DB, ...JSON.parse(s) }; }
                    catch(e) { DB = DEFAULT_DB; }
                } else {
                    DB = DEFAULT_DB;
                }
                // Migration checks
                if(!DB.holidayRanges) DB.holidayRanges = DEFAULT_DB.holidayRanges;
                if(!DB.payments) DB.payments = DEFAULT_DB.payments;
                if(!DB.links) DB.links = DEFAULT_DB.links;
                if(!DB.bonuses) DB.bonuses = DEFAULT_DB.bonuses;
            }
        };

        // IMPORTANT: keep init, but show splash premium + longer
        window.addEventListener('load', () => {
            Splash.start();
            App.init();
            Splash.finishWhenReady();
        });
    </script>
</body>
</html>
